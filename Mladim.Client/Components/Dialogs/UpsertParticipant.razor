@using Mladim.Client.Extensions;
@using Mladim.Client.Validators;
@using Mladim.Domain.Enums;


<MudDialog Style="min-width:400px;">
    <DialogContent>
        <MudForm @ref="@participantForm" Model="@participant" Validation="@(participantValidator.ValidateValue)" OnValidSubmit="OnValidSubmit">
            <MudStack Spacing="4">
                <MudTextField @bind-Value="participant.Name" For="@(() => participant.Name)" Variant="Variant.Outlined" Label="Ime" />
                <MudTextField @bind-Value="participant.Surname" For="@(() => participant.Surname)" Variant="Variant.Outlined" Label="Priimek" />

                <MudSelect @bind-Value="participant.Gender" For="@(() => participant.Gender)" T="Gender" ToStringFunc="@(gender => gender.GetDisplayAttributeString())" Variant="Variant.Outlined" Label="Spol" AnchorOrigin="Origin.BottomCenter">
                    @foreach (var gender in Enum.GetValues<Gender>())
                    {
                        <MudSelectItem Value="gender">@gender.GetDisplayAttributeString()</MudSelectItem>
                    }
                </MudSelect>

                <MudNumericField @bind-Value="participant.Age" For="@(() => participant.Age)" Label="Starost" Variant="Variant.Outlined" Min="0" Max="100"/>
                
                <MudSwitch @bind-Checked="participant.IsActive" Color="Color.Primary">@(participant.IsActive ? "Aktiven" : "Neaktiven")</MudSwitch>
                </MudStack>
            </MudForm>
        </DialogContent>
        <DialogActions>
            <MudButton Variant="Variant.Filled" Color="Color.Secondary" OnClick="Cancel">Prekliči</MudButton>
            <MudButton Variant="Variant.Filled" OnClick="OnValidSubmitAsync" Color="Color.Primary">@(participant.Id == 0 ? "Dodaj" : "Spremeni")</MudButton>
        </DialogActions>    
</MudDialog>


@code
{
    [CascadingParameter]
    MudDialogInstance MudDialog { get; set; }

    [Parameter]
    public ParticipantVM participant { get; set; }

    private MudForm? participantForm;
    private ParticipantValidator participantValidator = new ParticipantValidator();


    private async Task OnValidSubmitAsync()
    {
        await participantForm.Validate();

        if (participantForm.IsValid)
            MudDialog.Close(DialogResult.Ok(participant));
    }


    void Cancel() =>
        MudDialog.Cancel();


}

