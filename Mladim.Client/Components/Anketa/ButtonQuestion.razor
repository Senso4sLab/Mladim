@using Mladim.Client.ViewModels.Survey;
@using Mladim.Domain.Enums;
@using Syncfusion.Blazor.SplitButtons




<MudText Color="Color.Tertiary" Typo="Typo.h1" Class="py-3">@SurveyQuestion</MudText>
<ValidationMessage style="margin-bottom:0.4rem;" For="@(() => SurveyResponse.Response)"/>
 <div class="row">
    <div class="btn-group col-sm-12 col-lg-7">
        @foreach (var groupBtn in GroupButtons)
        {
            <button type="button" @onclick="(() => OnButtonClick(groupBtn.Value))" class="@groupBtn.CssClass">@groupBtn.Text</button>
        }
    </div>
 </div>



@code 
{

    [Parameter]
    public string SurveyQuestion { get; set; } = default!;    

    [Parameter]
    public QuestionButtonResponseVM SurveyResponse { get; set; } = default!;

    private List<GroupBtn> GroupButtons = new List<GroupBtn>
    {
        new GroupBtn("NE DRŽI", SurveyButtonResponseType.Incorrect),
        new GroupBtn("DELNO DRŽI", SurveyButtonResponseType.PartiallyCorrect),
        new GroupBtn("DRŽI", SurveyButtonResponseType.Correct),
        new GroupBtn("ZELO DRŽI", SurveyButtonResponseType.VeryCorrect),
    };

    // protected override void OnInitialized()
    // {
    //     //surveryButtonResponseVM = this.SurveyResponse.AddButtonResponse();
    //     //GroupButtons = GetButtonTypes().ToList();
    // }


    

    private void OnButtonClick(SurveyButtonResponseType btnType)
    {
        foreach (var groupBtn in GroupButtons)
        {
            if (groupBtn.Value == btnType)
                groupBtn.Active();
            else
                groupBtn.NoActive();
        }
        SurveyResponse.Response = btnType;
        StateHasChanged();
    }


    public class GroupBtn
    {
        public string CssClass { get; set; } = string.Empty;
        public SurveyButtonResponseType Value { get; }
        public string Text { get; }
     
        private string NotActiveSmile => "btn btn-primary shadow-none";
        private string ActiveSmile => $"{NotActiveSmile} group-btn-active";


        public GroupBtn(string text, SurveyButtonResponseType value)
        {
            this.Text = text;
            this.Value = value;
            this.CssClass = NotActiveSmile;
        }

        public void Active() =>
            this.CssClass = ActiveSmile;

        public void NoActive() =>
            this.CssClass = NotActiveSmile;
    }
}
