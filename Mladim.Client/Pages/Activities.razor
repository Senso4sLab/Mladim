@page "/activities"
@page "/activities/{projectId:int}"
@using Mladim.Client.ViewModels.Activity;


@attribute [Authorize]

<PageTitle>Aktivnosti</PageTitle>

 <MudStack Class="py-5" Spacing="3">
    <MudTextField Value="@defaultOrg?.Name" Label="Izbrana organizacija" Variant="Variant.Outlined" ReadOnly="true"></MudTextField>
    <MudText Typo="Typo.h5">Seznam aktivnosti</MudText>
 

    @if (activities.Count > 0)
    {
         <MudPaper Class="pa-3" >
            <MudGrid Spacing="2">
                <MudItem sm="6" xl="3" xs="12">
                    <MudDateRangePicker Label="Obdobje" DateRange="dateRange" DateRangeChanged="OnDateRangeChanged" Variant=Variant.Outlined Clearable />
                 </MudItem>
                 <MudItem sm="6" xl="3" xs="12">
                     <MudSelect T="NamedEntityVM" SelectedValues="selectedProjects" SelectedValuesChanged="OnProjectNameChanged" Label="Izberi projekt" Variant="Variant.Outlined" Clearable>
                        @foreach(var project in projects)
                        {
                            <MudSelectItem T="NamedEntityVM" Value="@project">@project.FullName</MudSelectItem>
                        }
                    </MudSelect>
                 </MudItem>
                 <MudItem sm="6" xl="3" xs="12">
                     <MudSelect T="NamedEntityVM" SelectedValuesChanged="OnProjectLeaderChanged" Label="Izberi vodjo projekta" Variant="Variant.Outlined" Clearable>
                     @foreach (var projectLead in projectLeads)
                        {
                            <MudSelectItem T="NamedEntityVM" Value="@projectLead">@projectLead.FullName</MudSelectItem>
                        }
                     </MudSelect>
                 </MudItem>
                 <MudItem sm="6" xl="3" xs="12">
                     <MudSelect T="NamedEntityVM" SelectedValuesChanged="OnActivityLeaderChanged" Label="Izberi vodnjo aktivnosti" Variant="Variant.Outlined" Clearable>
                     @foreach (var activityLead in activityLeads)
                        {
                            <MudSelectItem T="NamedEntityVM" Value="@activityLead">@activityLead.FullName</MudSelectItem>
                        }
                     </MudSelect>
                 </MudItem>
             </MudGrid>


            @if (filteredActivities.Count > 0)
            { 
                <SfGantt class="pt-5" DataSource="@filteredActivities" RowHeight="40" TaskbarHeight="30">
                    <GanttTaskFields Id="Id" Name="ActivityName" StartDate="StartDate" EndDate="EndDate" ParentID="ParentId"/>

                    <GanttColumns>
                        <GanttColumn Field="Id" HeaderText="Št."></GanttColumn>
                        <GanttColumn Field="ActivityName" HeaderText="Ime aktivnosti"></GanttColumn>
                        <GanttColumn Field="ProjectName" HeaderText="Ime projekta"></GanttColumn>
                        <GanttColumn Field="StartDate" HeaderText="Začetek" ></GanttColumn>
                        <GanttColumn Field="EndDate" HeaderText="Konec"></GanttColumn>
                    </GanttColumns>

                    <GanttTemplates TValue="ActivityForGantt">
                        <TaskbarTemplate>
                            <div class="e-gantt-parent-taskbar" style="background-color:#4da456; height:30px; border: 4px solid #4da456; border-radius:8px;"/>               
                        </TaskbarTemplate>
                    </GanttTemplates>
                    <GanttEvents TValue="ActivityForGantt" RowSelected="SelectedActivity"></GanttEvents>    
                </SfGantt>            
            }
        </MudPaper>
    }


</MudStack>


   






